# Playground Agents

## Purpose
This repository uses a root-controlled agency build system for all playground projects under `projects/`.

## Multi-Agent Readiness
- `config.toml` has `multi_agent = true`.
- Use `explorer` agents for fast repo discovery and code search.
- Use `worker` agents for scoped implementation tasks.
- Assign each worker explicit file ownership before execution.

## Shared Tasklist
- Shared board lives at `TASKLIST.md`.
- Keep all task movement inside these sections only:
  - `Active`
  - `Backlog`
  - `Archived`
- On task completion, move the item to `Archived` and mark it done.

## MCP Hub
- Local MCP servers are installed under `mcp/`.
- Active root config entries:
  - `mcp_servers.filesystem_local`
  - `mcp_servers.memory_local`
  - `mcp_servers.github_local`
  - `mcp_servers.github_modern_docker`
- GitHub MCP requires `GITHUB_PERSONAL_ACCESS_TOKEN` in the environment.
- Preferred GitHub route in VS Code is `github_modern_remote`; keep `github_legacy_local` as fallback.
- Full docs:
  - `wiki/agency-setup.md`
  - `wiki/mcp-setup.md`
  - `wiki/chat-session-bootstrap.md`
  - `wiki/remote-control-panel.md`

## Build Architecture Contract
- Root owns all dependencies, scripts, and build orchestration.
- Project source lives in `projects/<ProjectName>/src/...`.
- Per-project overrides live in `projects/<ProjectName>/project.config.json`.
- Compiled output is centralized in `dist/projects/<project-slug>/`.
- Dev server is auto-generated by root in dev modes with free-port allocation.

## Auto-Scaffold Rules
- Any folder under `projects/` is treated as a project.
- Missing source folders and starter files are generated from `templates/project/`.
- Legacy flat folders (`scss`, `js`, `images`, `fonts`, `docs`, `favicons`) are migrated into `src/` when possible.

## Primary Commands
- `npm run list:projects` lists discovered projects.
- `npm run scaffold` creates/mends project structure.
- `npm run build` builds the active project.
- `npm run build:all` builds all projects.
- `npm run dev` watches one active project.
- `npm run dev:all` watches all projects.

## Remote Control Panel Commands
- `npm run remote:panel`: start secure remote control web panel on localhost.
- `npm run remote:panel:lan`: start panel in LAN mode (`--host=0.0.0.0`).
- `npm run remote:panel -- --port=<port>`: override panel port at runtime.
- Canonical runbook: `wiki/remote-control-panel.md`.

## Remote Control Panel Security Guardrails
- Never execute raw user-submitted shell strings. Accept only allowlisted command IDs mapped to fixed command arrays.
- Require authentication for all state-changing routes and command execution routes.
- Require CSRF protection for all non-GET panel endpoints with both Origin/Referer validation and CSRF token checks.
- Bind to `127.0.0.1` by default. Any LAN bind must include explicit IP/CIDR allowlisting.
- External access must use HTTPS tunnel with upstream identity controls; do not expose direct public port forwarding.
- Preview proxy targets must be restricted to local dev server manifests under `.agency/dev-servers/*.json` and loopback hosts only.
- Block private metadata and SSRF targets by denying arbitrary upstream hosts, protocols, and ports.
- Log action source, target project, exit code, and duration; redact secrets/tokens from logs.
- Keep secrets in environment variables, not in repo files. Rotate session secrets and tunnel credentials on schedule.

## New Chat Bootstrap Commands
- `npm run chat:new`: standard session prep + MCP prep.
- `npm run chat:new:quick`: faster prep without build.
- `npm run chat:new:full`: install deps + prep + MCP.
- `npm run chat:briefing`: generate startup briefing markdown.
- `npm run mcp:prep`: validate MCP configs, env values, and memory file.

## Dev Server Outputs
- Single project mode serves `dist/projects/<slug>/`.
- All-project mode serves `dist/` (dashboard + project outputs).
- Server manifests are written to `.agency/dev-servers/*.json`.

## Active Project Selection
- Set `activeProject` in `agency.config.json`, or
- Use CLI override: `npm run dev:project -- --project=<name-or-slug>`.

## Local Skill Pack
Repository skills are stored under `skills/`:
- `skills/agency-playground-ops`
- `skills/mcp-orchestration-ops`
- `skills/chat-instance-bootstrap`

Skill utility commands:
- `npm run skills:list`
- `npm run skills:validate`
